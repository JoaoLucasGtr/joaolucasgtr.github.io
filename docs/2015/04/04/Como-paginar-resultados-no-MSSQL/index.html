<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="description" content="Este é o meu blog pessoal, onde você encontra os meus estudos escritos durante a minha jornada como desenvolvedor de software."><meta name="author" content="João Lucas Campos Gonçalves"><meta name="keywords" content="Web, Development, Javascript, Software"><title> Como paginar resultados no MSSQL | JoaoLucasGtr </title><link rel="stylesheet" href="/css/vs2015.css"><link rel="dns-prefetch" href="https://fonts.googleapis.com/"><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"><link rel="stylesheet" href="/css/style.css" type="text/css" media="all"><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"> </script><meta name="generator" content="Hexo 4.2.1"></head><body class="bg-light-gray"><nav class="navbar navbar-expand-lg navbar-light bg-white sticky-top shadow"><div class="container"><a class="navbar-brand" href="/">@joaolucasgtr</a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav ml-auto">     <a class="nav-item nav-link" href="/">Home</a><a class="nav-item nav-link" href="/archives">Archives</a><a class="nav-item nav-link" href="/about">About</a><button class="btn btn-outline-primary" data-toggle="modal" data-target="#search-modal"><i class="fa fa-search" id="search-enabled"></i></button></div></div></div></nav><div class="container mt-5"><div class="row"><div class="col-md-8 mb-4"><article><div class="card-body bg-white shadow-sm"><header><h2>Como paginar resultados no MSSQL</h2><div class="mb-3"><span class="text-muted">Apr 4, 2015 / 3 min. read</span><span class="text-muted float-right"><i>Updated at: 20/07/2020</i></span></div></header><div class="blog-post-body"><p><em>Revisado em 01/2016</em></p>
<p>Este documento tem como objetivo exemplificar duas maneiras distintas de se aplicar paginação utilizando o MSSQL Server.</p>
<p><strong>Objetivo:</strong></p>
<p>Reproduzir as operações de paginação corretas, de acordo com a tabela a seguir:</p>
<table>
<thead>
<tr>
<th><strong>Limite</strong></th>
<th><strong>Página 1</strong></th>
<th><strong>Página 2</strong></th>
<th><strong>Página 3</strong></th>
</tr>
</thead>
<tbody><tr>
<td>20</td>
<td>de 1 até 20</td>
<td>de 21 até 40</td>
<td>de 41 até 60</td>
</tr>
<tr>
<td>30</td>
<td>de 1 até 30</td>
<td>de 31 até 60</td>
<td>de 61 até 90</td>
</tr>
</tbody></table>
<p>Onde <strong>Limite</strong> é a quantidade de itens exibidos por página.</p>
<h3 id="Calculando-numero-de-linhas"><a href="#Calculando-numero-de-linhas" class="headerlink" title="Calculando número de linhas"></a>Calculando número de linhas</h3><p><strong>Sintaxe:</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span></span><br><span class="line">  (</span><br><span class="line">   <span class="keyword">SELECT</span> ROW_NUMBER() <span class="keyword">OVER</span> ( <span class="comment">/* [ordenação] */</span> ) <span class="keyword">AS</span> Linha</span><br><span class="line">        , *</span><br><span class="line">     <span class="keyword">FROM</span> <span class="comment">/* [tabela] */</span></span><br><span class="line">  ) <span class="keyword">AS</span> Linhas</span><br><span class="line"> <span class="keyword">WHERE</span> Linha &gt;= <span class="comment">/* [linha inicial] */</span> <span class="keyword">AND</span> Linha &lt;= <span class="comment">/* [linha final] */</span></span><br></pre></td></tr></table></figure>

<p>Desta maneira, o número atual da linha é retornado como uma coluna na tabela de resultados obtidos da <em>sub-query</em>. Isso permite a utilização dessa coluna para limitar os índices de início e fim dos resultados desejados.</p>
<p>Porém, utilizando essa abordagem, ainda é necessária a implementação de lógica para determinar esses valores, como demonstrado a seguir:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> @pagina1 <span class="built_in">INT</span> = <span class="number">3</span></span><br><span class="line">      , @limite1 <span class="built_in">INT</span> = <span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DECLARE</span> @linha_inicial <span class="keyword">AS</span> <span class="built_in">INT</span></span><br><span class="line">      , @linha_final   <span class="keyword">AS</span> <span class="built_in">INT</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">IF</span> @pagina1 &lt;&gt; <span class="number">1</span></span><br><span class="line">  <span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">SET</span> @linha_inicial = ((@pagina1 - <span class="number">1</span>) * @limite1) + <span class="number">1</span></span><br><span class="line">  <span class="keyword">END</span></span><br><span class="line"><span class="keyword">ELSE</span></span><br><span class="line">  <span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">SET</span> @linha_inicial = @pagina1</span><br><span class="line">  <span class="keyword">END</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> @linha_final = @limite1 * @pagina1</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> @linha_inicial <span class="keyword">AS</span> inicio, @linha_final <span class="keyword">AS</span> fim</span><br></pre></td></tr></table></figure>

<p><strong>Exemplo:</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">   - Tratando e obtendo valores para os índices;</span></span><br><span class="line"><span class="comment">   - Obtendo um resultado paginado da tabela de usuários ordenados</span></span><br><span class="line"><span class="comment">     pelo Id de forma decrescente;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DECLARE</span> @pagina1 <span class="built_in">INT</span> = <span class="number">3</span></span><br><span class="line">      , @limite1 <span class="built_in">INT</span> = <span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DECLARE</span> @linha_inicial <span class="keyword">AS</span> <span class="built_in">INT</span></span><br><span class="line">      , @linha_final   <span class="keyword">AS</span> <span class="built_in">INT</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">IF</span> @pagina1 &lt;&gt; <span class="number">1</span></span><br><span class="line">  <span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">SET</span> @linha_inicial = ((@pagina1 - <span class="number">1</span>) * @limite1) + <span class="number">1</span></span><br><span class="line">  <span class="keyword">END</span></span><br><span class="line"><span class="keyword">ELSE</span></span><br><span class="line">  <span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">SET</span> @linha_inicial = @pagina1</span><br><span class="line">  <span class="keyword">END</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> @linha_final = @limite1 * @pagina1</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span></span><br><span class="line">(</span><br><span class="line"> <span class="keyword">SELECT</span> ROW_NUMBER() <span class="keyword">OVER</span> (<span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">Id</span> <span class="keyword">DESC</span>) <span class="keyword">AS</span> Linha</span><br><span class="line">      , *</span><br><span class="line">   <span class="keyword">FROM</span> Usuario</span><br><span class="line">) <span class="keyword">AS</span> Linhas</span><br><span class="line"><span class="keyword">WHERE</span> Linha &gt;= @linha_inicial <span class="keyword">AND</span> Linha &lt;= @linha_final</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="Uma-“nova”-abordagem"><a href="#Uma-“nova”-abordagem" class="headerlink" title="Uma “nova” abordagem"></a>Uma “nova” abordagem</h3><p>A “nova” abordagem se assemelha aos recursos já presentes em outros <em>SGBDs</em> há mais tempo, como <strong>MySql</strong> ou <strong>Postgres</strong>, onde é necessário apenas a utilização de um valor para o <strong>OFFSET</strong> (índice inicial de obtenção dos resultados) e <strong>LIMIT</strong> (quantidade de resultados obtidos por página).</p>
<p><strong>Sintaxe:</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line">  <span class="keyword">FROM</span> <span class="comment">/* [tabela] */</span></span><br><span class="line"> <span class="comment">/* ordenação */</span></span><br><span class="line"><span class="keyword">OFFSET</span> <span class="comment">/* offset */</span> <span class="keyword">ROWS</span></span><br><span class="line"> <span class="keyword">FETCH</span> <span class="keyword">NEXT</span> <span class="comment">/* limit */</span> <span class="keyword">ROWS</span> <span class="keyword">ONLY</span></span><br></pre></td></tr></table></figure>

<p>Embora ainda seja necessária a utilização de lógica para obtenção dos valores de <strong>OFFSET</strong> e <strong>LIMIT</strong>, a sintaxe dessa abordagem é muito mais limpa e intuitiva, otimizando o tempo gasto em futuras refatorações.</p>
<p>Porém, esse recurso só está disponível na versão 12 ou posteriores do <strong>MSSQL</strong>.</p>
<p><strong>Exemplo:</strong></p>
<p>A seguir, uma implementação do exemplo dado anteriormente utilizando a nova sintaxe.</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> @pagina2 <span class="built_in">INT</span> = <span class="number">3</span></span><br><span class="line">      , @limite2 <span class="built_in">INT</span> = <span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line">  <span class="keyword">FROM</span> Usuario</span><br><span class="line"> <span class="keyword">ORDER</span> <span class="keyword">BY</span> ErpId <span class="keyword">DESC</span></span><br><span class="line"><span class="keyword">OFFSET</span> @limite2 * (@pagina2 - <span class="number">1</span>) <span class="keyword">ROWS</span></span><br><span class="line"> <span class="keyword">FETCH</span> <span class="keyword">NEXT</span> @limite2 <span class="keyword">ROWS</span> <span class="keyword">ONLY</span></span><br></pre></td></tr></table></figure>

<h3 id="Conclusao"><a href="#Conclusao" class="headerlink" title="Conclusão"></a>Conclusão</h3><p>Os resultados obtidos nas duas <em>queries</em> de exemplo são equivalentes, exceto pelo fato de que na abordagem utilizando <strong>ROW_NUMBER()</strong> o número da linha é retornado como uma coluna extra na tabela de resultados.</p>
</div><hr><h4>Other posts<span class="mr-2">:</span></h4><div class="row mb-5"><div class="col-6"><p>Previous</p><a href="/2015/08/10/Estrutura-de-diretorios-Linux/"><i class="fa fa-chevron-left mr-2"></i><span>Estrutura de diretórios Linux</span></a></div><div class="col-6 text-right"><p>Next</p><a href="/2015/03/04/O-que-e-Markdown/"><span>O que é Markdown?</span><i class="fa fa-chevron-right ml-2"></i></a></div></div><hr><h4>Leave a comment<span class="mr-2">:</span></h4><div id="disqus_thread"></div><script>var disqus_config = function () {
  this.page.url = 'https://joaolucasgtr.github.io/2015/04/04/Como-paginar-resultados-no-MSSQL/';
  this.page.identifier = '2015/04/04/Como-paginar-resultados-no-MSSQL/';
  this.page.title = 'Como paginar resultados no MSSQL';
};

</script><script>(function() {
  var d = document, s = d.createElement('script');
  s.src = 'https://joaolucasgtr.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
})();
</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a></noscript></div></article></div><div class="col-md-4"><aside><section class="text-center p-4 shadow mb-4 bg-white social-card"><a href="/about"><img class="social-avatar mt-5 mb-3 rounded-circle" src="https://www.gravatar.com/avatar/9acc26af4be808453f27f200036c6315?s=160"></a><h4>@joaolucasgtr</h4><p class="text-justify mt-3">Hi, my name is João Lucas and I'm a passionate fullstack developer.</p><hr><p>Find me:</p><div class="row"><div class="col-12"><a class="btn btn-light rounded-circle" href="mailto:joaolucasgtr@gmail.com" target="_blank" title="email"><i class="fa fa-lg fa-envelope text-primary"></i></a><a class="btn btn-light rounded-circle ml-2" href="https://github.com/joaolucasgtr" target="_blank" title="github"><i class="fa fa-lg fa-github text-primary"></i></a><a class="btn btn-light rounded-circle ml-2" href="https://gitlab.com/joaolucasgtr" target="_blank" title="gitlab"><i class="fa fa-lg fa-gitlab text-primary"></i></a><a class="btn btn-light rounded-circle ml-2" href="https://br.linkedin.com/in/joaolucasgtr" target="_blank" title="linkedin"><i class="fa fa-lg fa-linkedin text-primary"></i></a><a class="btn btn-light rounded-circle ml-2" href="https://www.youtube.com/channel/UCmLqk_keqMDtbwuMDPuDOzQ" target="_blank" title="youtube"><i class="fa fa-lg fa-youtube text-primary"></i></a></div></div></section><div class="bg-white shadow mb-4 p-4"><h4>Recent posts</h4><ul class="circle-list -list"><li class="circle-list -list-item"><a class="circle-list -list-link" href="/2018/01/26/Checklist-Ambiente/">Checklist Ambiente</a></li><li class="circle-list -list-item"><a class="circle-list -list-link" href="/2017/09/03/Por-que-utilizar-Linux-na-sua-empresa/">Por que utilizar Linux na sua empresa?</a></li><li class="circle-list -list-item"><a class="circle-list -list-link" href="/2017/06/15/Introducao-ao-Git/">Introdução ao Git</a></li><li class="circle-list -list-item"><a class="circle-list -list-link" href="/2017/03/20/Arquitetura-SOA/">SOA - Service Oriented Architecture</a></li><li class="circle-list -list-item"><a class="circle-list -list-link" href="/2017/03/20/O-padrao-DAO/">O padrão DAO</a></li><li class="circle-list -list-item"><a class="circle-list -list-link" href="/2017/02/20/SOLID/">SOLID (com exemplos)</a></li></ul></div><div class="bg-white shadow mb-4 p-4 text-center"><h4>Categories</h4><a class="circle-list -link" href="/categories/fundamentals/">fundamentals</a></div><div class="bg-white shadow mb-4 p-4 text-center"><h4>Tags</h4><a class="circle-list -link" href="/tags/database/" rel="tag">database</a></div></aside></div></div></div><br><footer class="mt-4 py-4 text-white bg-dark"><div class="container"><div class="col-12 text-center"><a href="https://hexo.io/" target="_blank" rel="noopener">Powered by Hexo</a><span class="ml-2">| Copyright ©<span class="ml-1">joaolucasgtr</span><span class="ml-1">2020</span></span></div></div></footer><div class="modal fade" id="search-modal" tabindex="-1" role="dialog" aria-hidden="true"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Search</h5><button class="close" data-dismiss="modal" aria-label="Close"><span>&times;</span></button></div><div class="modal-body"><div class="row"><div class="col-md-12"><input class="form-control" onkeyup="search(this)"></div></div><div class="row mt-3"><div class="col-md-12" id="search-results"></div></div></div></div></div></div><script id="dsq-count-scr" src="https://undefined.disqus.com/count.js"></script><script src="https://code.jquery.com/jquery-3.3.1.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script><script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script><script src="/javascripts/app.js"></script></body></html>